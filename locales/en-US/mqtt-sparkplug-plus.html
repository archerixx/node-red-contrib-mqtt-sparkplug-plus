<script type="text/html" data-help-name="mqtt sparkplug device">
    <p>This node will connect to an MQTT Server and act as an MQTT Edge of Network (EoN) Node. The node handles the following message types:</p>
    
    <ul>
        <li>DBIRTH</li>
        <li>NCMD : REBIRTH</li>
        <li>NDEATH</li>
        <li>DDATA (from node input)</li>
        <li>DCMD (send as output to Node-Red)</li>
        <li>NBIRTH</li>
    </ul>

  <p>The following features are not supported (yet):</p>
    <ul>
        <li>Non-metrics (body/Metadata)</li>
        <li>Buffering (Primary SCADA)</li>
        <li>MQTT Broker redundancy</li>
    </ul>
    <h3>Getting Started</h3>
    <p>The easiest way to get started is to import the example node.</p>
    
    <p>You do that by pressing the Import button in Node-Red, and selecting the Examples Tab, and open the <i>node-red-contrib-mqtt-sparkplug-plus</i> - <b>Simple Device</b> Example</p>
    <h3>Inputs</h3>
    <p>One or more metrics can be published by the device by passing the metrics information to the input of the device. A birth message will not be send before all metrics have been received at least once. so make sure to pass all metrics on start up.</p>
    <p>if a metric does not have a value then a "is_null" attribute is added to the metric</p>
    <p> Metric timestamps are optional per the specification. If timetamp are not supplied, then the current time will still be added to the DBIRTH message (nothing will be added to the DDATA). </p>

    <h4>Example:</h4>
    <pre>
        msg.payload = {
            "metrics": [
                {
                    "name": "testing/test1",
                    // Timestamp  is optional.
                    "timestamp" : new Date(),
                    "value": 11
                },
                {
                    "name": "testing/test2",
                    "value": 12
                }
            ]
        };
    </pre>

   <h3>Outputs</h3>
       <dl class="message-properties">
       <dt>payload
           <span class="property-type">object</span>
       </dt>
       <dd>The NCMD payload. See <a href="https://s3.amazonaws.com/ignition-modules/Current/Sparkplug+Specification.pdf">Sparkplug specification</a> for more information</dd>
       </dl>

       <h3>Sparkplug Message Types</h3>
       The connection node will handle the following messages:
       <h4>NBIRTH</h4>
        <p>Node Birth will be send by the node when the node-red runtime has started and the node has a connection the the MQTT Broker. This message will also be send when a "Rebirth" NCMD is received</p>
        <h4>NCMD</h4>
        The MQTT Sparkplug Device node will handle the following messages:
        <p>The node will handle incoming NCMD commands (currently only Rebirth is supported)</p>
        <h4>NDEATH</h4>
        <p>The node will send NDEATH when node-red runtime is stopped (it will be send on both a gracefull shutdown and a unexpected shutdown).</p>
        <h4>DBIRTH</h4>
        <p>Node Birth will be send by the node when all metrics have been received at least once, the node-red runtime has started and the node has a connection the the MQTT Broker. This message will also be send when a "Rebirth" NCMD is received</p>
        <h4>DCMD</h4>
        <p>NCMDs will be send to the node output port.</p>
        <h4>DDEATH</h4>
        <p>DDEATH is not currently supported.</p>    
</script>

<script type="text/html" data-help-name="mqtt sparkplug in">
    <p>Connects to a MQTT broker and subscribes to messages from the specified topic.</p>
        <h3>Outputs</h3>
        <dl class="message-properties">
           <dt>payload <span class="property-type">string | buffer</span></dt>
           <dd>a string unless detected as a binary buffer.</dd>
           <dt>topic <span class="property-type">string</span></dt>
           <dd>the MQTT topic, uses / as a hierarchy separator.</dd>
           <dt>qos <span class="property-type">number</span> </dt>
           <dd>0, fire and forget - 1, at least once - 2, once and once only.</dd>
           <dt>retain <span class="property-type">boolean</span></dt>
           <dd>true indicates the message was retained and may be old.</dd>
        </dl>
        <h3>Details</h3>
        The subscription topic can include MQTT wildcards, + for one level, # for multiple levels.</p>
        <p>This node requires a connection to a MQTT broker to be configured. This is configured by clicking
        the pencil icon.</p>
        <p>Several MQTT nodes (in or out) can share the same broker connection if required.</p>
    </script>
